# -*- coding: utf-8 -*-
import sys
from mcp.server.fastmcp import FastMCP


mcp = FastMCP("AnalysisServer")

@mcp.tool()
def get_analysis_prompt() -> str:
    """
    获取：当用户要求生成分析报告时，推荐给模型遵循的工具调用流程提示词。
    """
    return (
        "当用户要求生成分析报告时，请遵循以下工具调用流程，模型需根据数据实际情况判断是否需要执行相关操作：\n\n"
        "### 1. **文件读取**\n"
        "   - 使用 `mcp.tool` 方法从指定路径读取文件。\n"
        "   - 确保文件格式正确并成功加载。\n"
        "   - 如果文件格式错误或无法加载，请返回错误信息并指导用户修正。\n\n"
        "### 2. **数据检查与处理（模型判断是否必要）**\n"
        "   - 根据数据的实际情况，判断是否需要清洗或处理：\n"
        "     - **缺失值检测与处理**：如果存在缺失值，进行填充或删除操作。\n"
        "     - **重复值检测与处理**：如果存在重复值，进行去重操作。\n"
        "     - **异常值检测与处理**：如果存在异常值，模型可根据上下文选择处理策略。\n"
        "   - 如果执行数据处理操作，请调用相关 `mcp.tool` 方法。\n"
        "   - 数据处理后的结果存放在 `./temp` 文件夹中，命名清晰（如 `cleaned_data.csv`）。\n\n"
        "### 3. **描述性分析（模型判断是否必要）**\n"
        "   - 对输入数据进行结构化检查，判断是否需要生成描述性分析。\n"
        "   - 如果必要，生成以下内容：\n"
        "     - 数据的行列数。\n"
        "     - 每列的特征名、数据类型。\n"
        "     - 缺失值统计。\n"
        "     - 样本分布（如类别分布、数值列的分布等）。\n"
        "   - 如果生成图表（如直方图、箱线图），将图表保存至 `./temp` 文件夹，并记录文件路径。\n\n"
        "### 4. **统计分析（模型判断是否必要）**\n"
        "   - 根据数据类型和内容，判断是否需要执行统计分析。\n"
        "   - 如果执行，生成以下内容（视数据情况选择性输出）：\n"
        "     - **数值列**：均值、标准差、最大值、最小值等。\n"
        "     - **分类列**：类别分布、频次统计等。\n"
        "     - **相关性分析**：数值列之间或分类列之间的关联性。\n"
        "   - 生成结果（如表格）和可视化图表，保存在 `./temp` 文件夹。\n\n"
        "### 5. **总结（模型判断是否必要）**\n"
        "   - 根据描述性分析和统计分析结果，判断是否需要生成总结部分。\n"
        "   - 如果生成总结，提炼以下内容：\n"
        "     - 数据特征分布。\n"
        "     - 核心发现（如关联性、主要类别分布等）。\n"
        "   - 确保总结内容语言简洁、重点突出，并默认使用用户的语言。\n\n"
        "### 6. **报告生成**\n"
        "   - 使用 `mcp.tool` 方法生成分析报告，除非用户指定格式，否则默认生成 PDF。\n"
        "   - 报告内容包括：\n"
        "     1. 简介。\n"
        "     2. 描述性分析结果（如有）。\n"
        "     3. 统计分析结果（如有）。\n"
        "     4. 图表嵌入（如有）。\n"
        "     5. 总结部分（如有）。\n"
        "   - 报告生成后，提示用户保存路径；如果未指定路径，文件存储在 `./outputs` 下。\n\n"
        "### 7. **清理临时文件**\n"
        "   - 删除 `./temp` 文件夹及其中间文件，确保输出目录干净。\n\n"
        "### 提示\n"
        "   - 模型需根据数据的实际内容动态判断是否执行数据处理、分析或生成相关内容。\n"
        "   - 任何步骤出错时，请及时返回错误信息，并指导用户如何修正问题。\n"
        "   - 调用工具时，请严格按照工具说明文档或调用方法。\n"
    )

if __name__ == "__main__":
    mcp.run(transport='stdio')